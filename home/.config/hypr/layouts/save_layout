#!/usr/bin/env python3
import json
import subprocess
import sys
from pathlib import Path

FILE_PATH = "~/.config/hypr/layouts/saved/"

def get_workspace_clients(workspace_id: int) -> list[dict]:
    result = subprocess.run(
        ["hyprctl", "clients", "-j"],
        capture_output=True,
        text=True
    )
    clients = json.loads(result.stdout)
    return [c for c in clients if c["workspace"]["id"] == workspace_id]

def save_layout(workspace_id: int, filename: str):
    clients = get_workspace_clients(workspace_id)
    output_dir = Path(FILE_PATH).expanduser()
    output_dir.mkdir(parents=True, exist_ok=True)
    output_file = output_dir / filename
    with open(output_file, "w") as f:
        json.dump(clients, f, indent=2)

    print(f"Saved {len(clients)} clients to {output_file}")

if __name__ == "__main__":
    ws = int(sys.argv[1]) if len(sys.argv) > 1 else 5

    out = sys.argv[2] if len(sys.argv) > 2 else f"workspace_{ws}.json"

    save_layout(ws, out)
