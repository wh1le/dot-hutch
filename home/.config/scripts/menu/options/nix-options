#!/usr/bin/env bash
set -euo pipefail

sep=$'\034'  # field separator required by sway-launcher-desktop


sep=$'\034'  # field separator required by sway-launcher-desktop

manix "" \
  | grep '^# ' \
  | sed 's/^# \(.*\) (.*/\1/;s/ (.*//;s/^# //' \
  | while IFS= read -r opt; do
      [ -z "$opt" ] && continue
      # key = opt, provider = nix-options, label = opt
      printf '%s%snix-options%s%s\n' "$opt" "$sep" "$sep" "$opt"
    done
#
#
# # manix "" prints blocks separated by blank lines
# manix "" \
#   | awk -v RS="" -v sep="$sep" '
#     {
#       opt = ""
#       desc = ""
#
#       # split this paragraph into lines
#       n = split($0, a, "\n")
#
#       for (i = 1; i <= n; i++) {
#         line = a[i]
#
#         # option name line: "# services.xxx..."
#         if (line ~ /^# /) {
#           opt = line
#           sub(/^# /, "", opt)
#           continue
#         }
#
#         # stop collecting description at type:
#         if (line ~ /^type:/) {
#           break
#         }
#
#         # collect description lines after we saw an option
#         if (opt != "" &&
#             line !~ /^NixOS Options/ &&
#             line !~ /^─+$/ &&
#             line !~ /^[[:space:]]*$/) {
#           if (desc == "")
#             desc = line
#           else
#             desc = desc " " line
#         }
#       }
#
#       if (opt != "") {
#         label = opt
#         if (desc != "")
#           label = label "  —  " desc
#
#         # key = opt, provider = nix-options, label = label
#         printf "%s%snix-options%s%s\n", opt, sep, sep, label
#       }
#     }
#   '
