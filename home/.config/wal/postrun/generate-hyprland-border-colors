#!/usr/bin/env bash
# Post-pywal script to generate lighter border colors
COLORS_FILE="$HOME/.cache/wal/colors.sh"
OUTPUT_FILE="$HOME/.cache/wal/colors-hyprland-borders.conf"
SWAYNC_OUTPUT="$HOME/.cache/wal/colors-swaync-borders.css"

# Source the colors
source "$COLORS_FILE"

hex_to_rgb() {
  local hex="${1#\#}"
  printf "%d %d %d" "0x${hex:0:2}" "0x${hex:2:2}" "0x${hex:4:2}"
}

lighten_color() {
  local hex="$1"
  local percent="$2"
  read -r r g b <<<"$(hex_to_rgb "$hex")"

  # Calculate lighter values (move towards 255)
  r=$((r + (255 - r) * percent / 100))
  g=$((g + (255 - g) * percent / 100))
  b=$((b + (255 - b) * percent / 100))

  # Clamp to 255
  [ $r -gt 255 ] && r=255
  [ $g -gt 255 ] && g=255
  [ $b -gt 255 ] && b=255

  printf "%02x%02x%02x" "$r" "$g" "$b"
}

darken_color() {
  local hex="$1"
  local percent="$2"
  read -r r g b <<<"$(hex_to_rgb "$hex")"

  # Calculate darker values (move towards 0)
  r=$((r - r * percent / 100))
  g=$((g - g * percent / 100))
  b=$((b - b * percent / 100))

  # Clamp to 0
  [ $r -lt 0 ] && r=0
  [ $g -lt 0 ] && g=0
  [ $b -lt 0 ] && b=0

  printf "%02x%02x%02x" "$r" "$g" "$b"
}

border_active1=$(lighten_color "$color1" 10)
border_active2=$(lighten_color "$color1" 40)
border_inactive=$(darken_color "$color0" 20)

foreground_hex="${foreground#\#}"
background_hex="${background#\#}"
color0_hex="${color0#\#}"
color1_hex="${color1#\#}"
color2_hex="${color2#\#}"
color3_hex="${color3#\#}"
color4_hex="${color4#\#}"
color5_hex="${color5#\#}"
color6_hex="${color6#\#}"
color7_hex="${color7#\#}"
color8_hex="${color8#\#}"
color9_hex="${color9#\#}"
color10_hex="${color10#\#}"
color11_hex="${color11#\#}"
color12_hex="${color12#\#}"
color13_hex="${color13#\#}"
color14_hex="${color14#\#}"
color15_hex="${color15#\#}"

# Write to output file
cat >"$OUTPUT_FILE" <<EOF
# Generated by pywal post-run script
# Border colors for Hyprland
\$border_active1 = 0xff${border_active1}
\$border_active2 = 0xff${border_active2}
\$border_inactive = 0xff${border_inactive}

# Base colors (0xff format)
\$foreground = 0xff${foreground_hex}
\$background = 0xff${background_hex}

# Colors in rgb() format for plugins
\$color0 = rgb(${color0_hex})
\$color1 = rgb(${color1_hex})
\$color2 = rgb(${color2_hex})
\$color3 = rgb(${color3_hex})
\$color4 = rgb(${color4_hex})
\$color5 = rgb(${color5_hex})
\$color6 = rgb(${color6_hex})
\$color7 = rgb(${color7_hex})
\$color8 = rgb(${color8_hex})
\$color9 = rgb(${color9_hex})
\$color10 = rgb(${color10_hex})
\$color11 = rgb(${color11_hex})
\$color12 = rgb(${color12_hex})
\$color13 = rgb(${color13_hex})
\$color14 = rgb(${color14_hex})
\$color15 = rgb(${color15_hex})
EOF

cat >"$SWAYNC_OUTPUT" <<EOF
@define-color border_active1 #${border_active1};
@define-color border_active2 #${border_active2};
@define-color border_inactive #${border_inactive};
EOF

echo "Generated Hyprland border colors: $OUTPUT_FILE"
echo "Generated swaync colors: $SWAYNC_OUTPUT"
