#!/usr/bin/env bash
set -euo pipefail

: "${LAUNCHER_SCRIPTS_PATH:=$HOME/.local/bin/public/menu}"

source "$LAUNCHER_SCRIPTS_PATH/helpers/fzf-with-options"

SCRIPT_DIR="$LAUNCHER_SCRIPTS_PATH/options"

declare -A OPTIONS=(
  ["󰣆 Applications"]="applications"
  [" 2FA OTP"]="pass-otp"
  [" Ruby Gems"]="ruby-gems"
  ["󰧻 Kill Process"]="kill-process"
  ["󰐥 Power Management"]="power-management"
  [" Passwords"]="pass-list:--safe-mode"
  [" Passwords (All)"]="pass-list"
  [" Audio"]="audio"
  [" (Nix) Packages"]="nix-search-packages"
  [" (Nix) Options"]="nix-search-options"
  [" Clipboard"]="clipboard-history"
  ["󱠾 OpenVPN Connect"]="openvpn-connect"
  ["󰤨 Wi-Fi connect"]="wifi-connect"
  [" (Nix) Switch"]="nix-switch"
  ["󰍹 Display Profiles (Kanshi)"]="kanshi-profiles"
  [" (Nix) Home Options"]="nix-search-home-options"
  [" Bluetooth"]="bluetooth"
  ["󰣌 Wallpaper"]="wallpaper"
  [" Scan OTP"]="pass-scan-otp"
  ["󰲸 (MPD) Create Plalist"]="mpd-create-playlist"
  [" (MPD) Add Song to Plalist"]="mpd-add-song-to-playlist"
  # ["󰖟 Browser History"]="browser-history"
  # "browser-bookmarks:󰖟 Browser Bookmarks"
  #"connect-bluetooth: Connect Bluetooth"
  #"connect-bluetooth:󰖩 Connect Wi-Fi"
  #"search-youtube:󰕧 Search Youtube"
)

if [[ -n "${1:-}" ]]; then
  key="$1"
  args=""
else
  label="$(printf '%s\n' "${!OPTIONS[@]}" | fzf)" || exit 0
  value="${OPTIONS[$label]}"
  key="${value%%:*}"
  args="${value#*:}"
  [[ "$args" == "$value" ]] && args=""
fi

if [[ "$key" == /* ]]; then
  script="$key"
else
  script="${SCRIPT_DIR}/${key}"
fi

if [[ -x "$script" ]]; then
  exec "$script" $args
elif [[ -f "$script" ]]; then
  exec bash "$script" $args
else
  printf "script not found: %s\n" "$script" >&2
  exit 1
fi
