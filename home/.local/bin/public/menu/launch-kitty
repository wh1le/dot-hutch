#!/usr/bin/env bash

: "${LAUNCHER_SCRIPTS_PATH:=$HOME/.local/bin/public/menu}"
: "${KITTY_LAUNCHER_CLASS:=launcher}"
: "${KITTY_LAUNCHER_SOCKET_PATH:=/tmp/kitty-launcher}"

source "$LAUNCHER_SCRIPTS_PATH/helpers/spawn-kitty"

run() {
  local output
  if ! output=$("$@" 2>&1); then
    notify-send -u critical "Launcher Error" "$*\n\n$output"
    exit 1
  fi
}

option=${1-}

if [ -z "$option" ]; then
  run spawn-kitty "$LAUNCHER_SCRIPTS_PATH/launch-tty"
else
  run spawn-kitty "$LAUNCHER_SCRIPTS_PATH/options/$option"

  if pgrep -f 'kitty.*--class '"$KITTY_LAUNCHER_CLASS" >/dev/null; then
    kitty @ --to unix:$KITTY_LAUNCHER_SOCKET_PATH close-window
  fi
fi
