#!/usr/bin/env bash

set -euo pipefail

# get_current_monitor_is_eink() {
#   # local monitor_name=$(hyprctl activeworkspace -j | jq -r '.monitor')
#   # local monitor_desc=$(hyprctl monitors -j | jq -r --arg name "$monitor_name" '.[] | select(.name == $name) | .description')
#   #
#   # [[ "$monitor_desc" =~ [Dd]asung|[Pp]aperlike ]]
#   return 1
# }

spawn_kitty() {
  local command=${1:-}
  local extra_options=${2:-}
  local kitty_options="
    --listen-on unix:${KITTYNATOR_SOCKET_PATH}
    --class ${KITTYNATOR_HYPRLAND_CLASS}
    $KITTYNATOR_STARTUP_OPTIONS
    $extra_options
  "

  # if get_current_monitor_is_eink; then
  #   kitty_options="$kitty_options -o include=$HOME/.cache/wal/eink-kitty-theme.conf"
  # fi

  if [ -n "$KITTYNATOR_SOCKET_PATH" ] && [ -S "$KITTYNATOR_SOCKET_PATH" ]; then
    kitty @ --to "unix:$KITTYNATOR_SOCKET_PATH" close-window
  fi

  kitty $kitty_options zsh -lc "exec $command"
}

export -f spawn_kitty
