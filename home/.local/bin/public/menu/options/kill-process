#!/usr/bin/env bash

set -euo pipefail

source "$LAUNCHER_SCRIPTS_PATH/helpers/fzf-with-options"

if pgrep -f 'kitty.*--class '"$KITTY_LAUNCHER_CLASS" >/dev/null; then
  hyprctl dispatch resizeactive 100 200
  hyprctl dispatch centerwindow
  kitty @ --to unix:/tmp/kitty-launcher set-font-size 10
fi

# Build a list of processes and let fzf pick one
choice=$(
  ps -eo pid,user,comm --sort=-pid |
    awk 'NR>1 {printf "%-7s %-12s %s\n", $1, $2, $3}' |
    fzf-with-options \
      --prompt="Kill Â» "
) || exit 0 # ESC in fzf

# First column is PID
pid=$(awk '{print $1}' <<<"$choice")

[ -n "${pid:-}" ] || exit 0

# Kill with sudo
sudo kill "$pid"
