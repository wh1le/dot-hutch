#!/usr/bin/env bash
set -euo pipefail

unset FZF_DEFAULT_OPTS FZF_CTRL_R_OPTS

kitty -o font_size=14 --single-instance --class launcher bash -lc '
  sep=$'"'"'\034'"'"'
  SCRIPT_DIR="$HOME/.config/scripts/menu/options"

  OPTIONS=(
    "applications:󰣆 Applications"
    "nix-packages: Nix Search Packages"
    "nix-options: Nix Options"
    "nix-switch: Nix Switch"
    #"bookmarks:󰖟 Browser Bookmarks"
    #"history:󰖟 Browser History"
    #"pass: Passwords"
    #"pass:2FAuthnetication"
    "kill:󰧻 Kill Program"
    #"connect-bluetooth: Connect Bluetooth"
    #"connect-bluetooth:󰖩 Connect Wi-Fi"
    #"search-youtube:󰕧 Search Youtube"
  )

  choice="$(
    for opt in "${OPTIONS[@]}"; do
      IFS=":" read -r key label <<<"$opt"
      printf "%s%s%s\n" "$key" "$sep" "$label"
    done | fzf \
      --ansi \
      --margin="1,1,1,1" \
      --cycle \
      --color="gutter:-1,border:238,scrollbar:238" \
      --delimiter="$sep" \
      --with-nth=2 \
      --no-info \
      --prompt="> "
  )" || exit 0

  key=${choice%%"$sep"*}
  script="${SCRIPT_DIR}/${key}"

  if [[ -x "$script" ]]; then
    exec "$script"
  elif [[ -f "$script" ]]; then
    exec bash "$script"
  else
    printf "script not found: %s\n" "$script" >&2
    exit 1
  fi
'

