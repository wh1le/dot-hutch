#! /usr/bin/env python3

import json
import time
from urllib.error import HTTPError, URLError
from urllib.parse import urlencode
from urllib.request import Request, urlopen

BASE_URL = "https://marine-api.open-meteo.com/v1/marine"
RETRIES  = 5
TIMEOUT  = 10

def fetch_ocean_information(lat, lon, decimal=4, unit="metric"):
    body = None

    params = {
        "latitude": round(lat, decimal),
        "longitude": round(lon, decimal),
        "current": "wave_height,wave_direction,wave_period",
        "length_unit": unit,
        "timezone": "auto"
    }

    url = f"{BASE_URL}?{urlencode(params)}"

    # simple retry logic replacing `retry(...)`
    for attempt in range(RETRIES):
        try:
            req = Request(url)

            with urlopen(req, timeout=TIMEOUT) as resp:
                if resp.status != 200:
                    raise HTTPError(url, resp.status, resp.reason, resp.headers, None)
                else:
                    body = json.loads(resp.read().decode("utf-8"))
            break
        except (URLError, HTTPError, ValueError):
            if attempt == 4:
                body = None

            time.sleep(1.0 * (2 ** attempt))

    return body

body = fetch_ocean_information(38.6446, 9.2334)

if body:
    height = body.get("current", {}).get("wave_height")

    print(f"Û±ùÜ {height}m")