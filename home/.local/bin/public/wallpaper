#!/usr/bin/env bash
set -euo pipefail

# props to https://github.com/BreadOnPenguins/scripts/blob/master/wallpapermenu

FOLDER=~/dot/wallpapers/rotated

EINK_MONITOR="HDMI-A-1" # swww query
EINK_DEFAULT_WALLPAPER="$HOME/dot/files/assets/white-background.jpg"

pkill nsxiv || true

menu() {
  # CHOICE=$(nsxiv -otb $FOLDER/*)
  CHOICE=$(ls $FOLDER/* | shuf | xargs nsxiv -otb)

  case $CHOICE in
  *.*)
    swww img --outputs "DP-1" --transition-type wipe --transition-angle 45 --transition-duration 0.8 "$CHOICE"
    ln -sf "$CHOICE" ~/.current_wallpaper
    wal -s -n -i "$CHOICE"

    ;;
  *) exit 0 ;;
  esac
}

# If given arguments:
# First argument will be used by pywal as wallpaper/dir path
# Second will be used as theme (use wal --theme to view built-in themes)

case "$#" in
0) menu ;;
1) wal -s -n -i "$1" ;;
2) wal -s -n -i "$1" --theme $2 ;;
*) exit 0 ;;
esac

swww img --outputs "$EINK_MONITOR" --transition-type none "$EINK_DEFAULT_WALLPAPER"
