#!/usr/bin/env bash

set -e

WALLPAPERS_PATH=~/dot/wallpapers/default-collection

CHOICE="$1"

MONITORS=$(hyprctl monitors -j | jq -r '.[] | select(.description | contains("Paperlike") | not) | "\(.name):\(.transform)"')

for entry in $MONITORS; do
  monitor="${entry%:*}"
  transform="${entry#*:}"

  resize_flag=""
  [[ "$transform" -eq 0 ]] && resize_flag="--resize fit"

  swww img \
    --outputs "$monitor" \
    --transition-type random \
    --transition-angle 45 \
    --resize fit \
    --transition-duration 1 "$CHOICE"
done

ln -s -f "$CHOICE" ~/.current_wallpaper
wal -esnti "$CHOICE"

$HOME/.local/bin/public/wallpaper/apply-wallpaper-eink
$HOME/.local/bin/public/wallpaper/apply-colors-globally
